# Data Model (Desktop Reference)

This document captures the data model used in the Electron desktop app so the
Android app can remain compatible with existing piles.

## Piles configuration (`piles.json`)
Location (desktop): `~/Piles/piles.json`

Shape (array):
```json
[
  {
    "name": "Personal",
    "path": "/Users/name/Piles/Personal",
    "theme": "light"
  }
]
```

Notes:
- `theme` is optional and defaults to `light`.
- `path` is absolute on desktop. Android should store a relative or internal
  app storage path.

## Pile folder structure (per pile)
```
<PileName>/
  index.json
  <year>/
    <Mon>/
      <YYMMDD-HHMMSS>.md
      media/
        <YYMMDD-HHMMSSmmm>.<ext>
```

## Post file format (Markdown + frontmatter)
Posts are Markdown files with YAML frontmatter stored by gray-matter.

Example:
```markdown
---
title: ""
createdAt: "2024-06-01T12:34:56.000Z"
updatedAt: "2024-06-01T12:34:56.000Z"
highlight: null
highlightColor: null
tags: []
replies: []
attachments: []
isReply: false
isAI: false
---
<p>HTML content generated by TipTap</p>
```

### Field definitions
- `title`: string (currently empty in most flows).
- `createdAt`, `updatedAt`: ISO-8601 strings.
- `highlight`, `highlightColor`: string or null.
- `tags`: array of strings.
- `replies`: array of relative file paths (e.g., `24/Jan/240101-123456.md`).
- `attachments`: array of paths to media under the pile folder.
- `isReply`, `isAI`: booleans.

## Index (`index.json`)
`index.json` is a JSON-serialized Map of `[relativePath, metadata]`.

Shape:
```json
[
  [
    "24/Jan/240101-123456.md",
    {
      "createdAt": "2024-06-01T12:34:56.000Z",
      "updatedAt": "2024-06-01T12:34:56.000Z",
      "tags": [],
      "replies": [],
      "isReply": false,
      "isAI": false
    }
  ]
]
```

Notes:
- The index can be regenerated by walking the pile and reading frontmatter.
- Android should support regenerating index from disk on import.
